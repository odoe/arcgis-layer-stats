import{bD as me,F as a,H as l,I as Q,J as Ee,eB as Ne,cu as Ie,A as L,fL as Oe,j as Y,by as R,bI as Re,eD as $e,s as Fe,k as $,a as Le,t as Ae,O as _e,ew as Pe,f2 as Ue,eA as Me,ex as Te,bt as je,bu as Ce,bv as qe,aM as Ve,dt as Be,r as D,bx as We,L as ne,b2 as De,eI as ke,g as He,gu as Ge,a0 as Xe,aV as Je,h as Qe,y as Ye,bm as k,eW as ze,$ as Ke,bA as Ze,bB as et,gv as tt}from"./index.e3323316.js";import{p as rt}from"./CollectionFlattener.e2759e14.js";import{i as se}from"./scaleUtils.51628f00.js";import{o as X}from"./crsUtils.ec00e4fa.js";const nt={visible:"visibleSublayers"};let N=class extends me(Ee){constructor(e){super(e),this.scale=0}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.sublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("wms-sublayer-update",r=>this.notifyChange(nt[r.propertyName]))],"layer"))}get layers(){return this.visibleSublayers.filter(({name:e})=>e).map(({name:e})=>e).join()}get version(){this.commitProperty("layers");const e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:e,scale:r}=this,t=e==null?void 0:e.sublayers,n=[],s=o=>{const{minScale:i,maxScale:d,sublayers:u,visible:p}=o;p&&(r===0||(i===0||r<=i)&&(d===0||r>=d))&&(u?u.forEach(s):n.push(o))};return t==null||t.forEach(s),n}toJSON(){const{layer:e,layers:r}=this,{imageFormat:t,imageTransparency:n,version:s}=e;return{format:t,request:"GetMap",service:"WMS",styles:"",transparent:n?"TRUE":"FALSE",version:s,layers:r}}};a([l()],N.prototype,"layer",null),a([l({readOnly:!0})],N.prototype,"layers",null),a([l({type:Number})],N.prototype,"scale",void 0),a([l({readOnly:!0})],N.prototype,"version",null),a([l({readOnly:!0})],N.prototype,"visibleSublayers",null),N=a([Q("esri.layers.support.ExportWMSImageParameters")],N);var j;let st=0,h=j=class extends Ne($e){constructor(e){super(e),this._sublayersHandles=new Ie,this.dimensions=null,this.fullExtents=null,this.featureInfoFormat=null,this.featureInfoUrl=null,this.legendUrl=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.popupEnabled=!1,this.queryable=!1,this.spatialReferences=null}get description(){return this._get("description")}set description(e){this._set("description",e)}get fullExtent(){return this._get("fullExtent")}set fullExtent(e){this._set("fullExtent",e)}readExtent(e,r){return(e=r.extent)?L.fromJSON(e):null}get id(){const e=this._get("id");return e!=null?e:st++}set id(e){this._set("id",e)}readLegendUrl(e,r){return r?r.legendUrl||r.legendURL:null}set layer(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach(r=>r.layer=e)}get effectiveScaleRange(){const{minScale:e,maxScale:r}=this;return{minScale:e,maxScale:r}}get name(){return this._get("name")}set name(e){this._set("name",e)}set sublayers(e){const r=this._get("sublayers");r&&(r.forEach(t=>{t.layer=null}),this._sublayersHandles.removeAll(),this._sublayersHandles=null),e&&(e.forEach(t=>{t.parent=this,t.layer=this.layer}),this._sublayersHandles.add([e.on("after-add",({item:t})=>{t.parent=this,t.layer=this.layer}),e.on("after-remove",({item:t})=>{t.parent=null,t.layer=null})])),this._set("sublayers",e)}castSublayers(e){return Oe(Y.ofType(j),e)}get title(){return this._get("title")}set title(e){this._set("title",e)}get visible(){return this._get("visible")}set visible(e){this._setAndNotifyLayer("visible",e)}clone(){const e=new j;return this.hasOwnProperty("description")&&(e.description=this.description),this.hasOwnProperty("fullExtent")&&(e.fullExtent=this.fullExtent.clone()),this.hasOwnProperty("fullExtents")&&(e.fullExtents=this.fullExtents.map(r=>r.clone())),this.hasOwnProperty("featureInfoFormat")&&(e.featureInfoFormat=this.featureInfoFormat),this.hasOwnProperty("featureInfoUrl")&&(e.featureInfoUrl=this.featureInfoUrl),this.hasOwnProperty("legendUrl")&&(e.legendUrl=this.legendUrl),this.hasOwnProperty("legendEnabled")&&(e.legendEnabled=this.legendEnabled),this.hasOwnProperty("layer")&&(e.layer=this.layer),this.hasOwnProperty("name")&&(e.name=this.name),this.hasOwnProperty("parent")&&(e.parent=this.parent),this.hasOwnProperty("queryable")&&(e.queryable=this.queryable),this.hasOwnProperty("sublayers")&&(e.sublayers=this.sublayers&&this.sublayers.map(r=>r.clone())),this.hasOwnProperty("spatialReferences")&&(e.spatialReferences=this.spatialReferences.map(r=>r)),this.hasOwnProperty("visible")&&(e.visible=this.visible),this.hasOwnProperty("title")&&(e.title=this.title),e}_setAndNotifyLayer(e,r){const t=this.layer;this._get(e)!==r&&(this._set(e,r),t&&t.emit("wms-sublayer-update",{propertyName:e,id:this.id}))}};a([l()],h.prototype,"description",null),a([l({readOnly:!0})],h.prototype,"dimensions",void 0),a([l({value:null})],h.prototype,"fullExtent",null),a([R("fullExtent",["extent"])],h.prototype,"readExtent",null),a([l()],h.prototype,"fullExtents",void 0),a([l()],h.prototype,"featureInfoFormat",void 0),a([l()],h.prototype,"featureInfoUrl",void 0),a([l({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],h.prototype,"id",null),a([l({type:String,json:{origins:{"web-document":{read:{source:["legendUrl","legendURL"]},write:{target:"legendUrl",ignoreOrigin:!0}}},read:{source:"legendURL"},write:{ignoreOrigin:!0}}})],h.prototype,"legendUrl",void 0),a([R(["web-document"],"legendUrl")],h.prototype,"readLegendUrl",null),a([l({value:!0,type:Boolean,json:{read:{source:"showLegend"},write:{target:"showLegend"},origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],h.prototype,"legendEnabled",void 0),a([l({value:null})],h.prototype,"layer",null),a([l()],h.prototype,"maxScale",void 0),a([l()],h.prototype,"minScale",void 0),a([l({readOnly:!0})],h.prototype,"effectiveScaleRange",null),a([l({type:String,value:null,json:{read:{source:"name"},write:{ignoreOrigin:!0}}})],h.prototype,"name",null),a([l()],h.prototype,"parent",void 0),a([l({type:Boolean,json:{read:{source:"showPopup"},write:{ignoreOrigin:!0,target:"showPopup"}}})],h.prototype,"popupEnabled",void 0),a([l({type:Boolean,json:{write:{ignoreOrigin:!0}}})],h.prototype,"queryable",void 0),a([l()],h.prototype,"sublayers",null),a([Re("sublayers")],h.prototype,"castSublayers",null),a([l({type:[Number],json:{read:{source:"spatialReferences"}}})],h.prototype,"spatialReferences",void 0),a([l({type:String,value:null,json:{write:{ignoreOrigin:!0}}})],h.prototype,"title",null),a([l({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"}}})],h.prototype,"visible",null),h=j=a([Q("esri.layers.support.WMSSublayer")],h);const J=h,T={84:4326,83:4269,27:4267};function it(e){if(!e)return null;const r={idCounter:-1};typeof e=="string"&&(e=new DOMParser().parseFromString(e,"text/xml"));const t=e.documentElement;if(t.nodeName==="ServiceExceptionReport"){const f=Array.prototype.slice.call(t.childNodes).map(v=>v.textContent).join(`\r
`);throw new Fe("wmslayer:wms-capabilities-xml-is-not-valid","The server returned errors when the WMS capabilities were requested.",f)}const n=x("Capability",t),s=x("Service",t),o=x("Request",n);if(!n||!s||!o)return null;const i=x("Layer",n);if(!i)return null;const d=t.nodeName==="WMS_Capabilities"||t.nodeName==="WMT_MS_Capabilities"?t.getAttribute("version"):"1.3.0",u=S("Title",s,"")||S("Name",s,""),p=S("AccessConstraints",s,""),y=/^none$/i.test(p)?"":p,m=S("Abstract",s,""),b=parseInt(S("MaxWidth",s,"5000"),10),w=parseInt(S("MaxHeight",s,"5000"),10),E=ae(o,"GetMap"),I=ie(o,"GetMap"),g=P(i,d,r);let z,V=0;if(Array.prototype.slice.call(n.childNodes).forEach(f=>{f.nodeName==="Layer"&&(V===0?z=f:(V===1&&g.name&&(g.name="",g.sublayers.push(P(z,d,r))),g.sublayers.push(P(f,d,r))),V++)}),!g)return null;let O,U;const be=g.fullExtents;if(O=g.sublayers,O||(O=[]),O.length===0&&O.push(g),U=g.extent,!U){const f=new L(O[0].extent);g.extent=f.toJSON(),U=g.extent}const xe=g.spatialReferences.length>0?g.spatialReferences:ye(g),K=ie(o,"GetFeatureInfo");let M;if(K){const f=ae(o,"GetFeatureInfo");f.includes("text/html")?M="text/html":f.includes("text/plain")&&(M="text/plain")}if(!M){const f=v=>{v&&(v.queryable=!1,v.sublayers&&v.sublayers.forEach(B=>{f(B)}))};f(g)}const Z=he(O),we=g.minScale||0,ve=g.maxScale||0,ee=g.dimensions,Se=Z.reduce((f,v)=>f.concat(v.dimensions),[]),te=ee.concat(Se).filter(ge);let re=null;if(te.length>0){let f=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;te.forEach(B=>{const{extent:W}=B;ot(W)?W.forEach(A=>{f=Math.min(f,A.getTime()),v=Math.max(v,A.getTime())}):W.forEach(A=>{f=Math.min(f,A.min.getTime()),v=Math.max(v,A.max.getTime())})}),re={startTimeField:null,endTimeField:null,trackIdField:null,timeExtent:[f,v]}}return{copyright:y,description:m,dimensions:ee,extent:U,fullExtents:be,featureInfoFormat:M,featureInfoUrl:K,mapUrl:I,maxWidth:b,maxHeight:w,maxScale:ve,minScale:we,layers:Z,spatialReferences:xe,supportedImageFormatTypes:E,timeInfo:re,title:u,version:d}}function at(e){return e.length?e.filter(r=>r.popupEnabled&&r.name&&r.queryable).map(r=>r.name).join():""}function ye(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(const r of e.sublayers){const t=ye(r);if(t.length>0)return t}return[]}function he(e){var t;let r=[];for(const n of e)r.push(n),(t=n.sublayers)!=null&&t.length&&(r=r.concat(he(n.sublayers)),delete n.sublayers);return r}function C(e,r,t){var n;return(n=r.getAttribute(e))!=null?n:t}function lt(e,r,t,n){const s=x(e,t);return s?C(r,s,n):n}function x(e,r){for(let t=0;t<r.childNodes.length;t++){const n=r.childNodes[t];if(fe(n)&&n.nodeName===e)return n}return null}function q(e,r){const t=[];for(let n=0;n<r.childNodes.length;n++){const s=r.childNodes[n];fe(s)&&s.nodeName===e&&t.push(s)}return t}function S(e,r,t){const n=x(e,r);return n?n.textContent:t}function _(e,r,t){if(!e)return null;const n=parseFloat(e.getAttribute("minx")),s=parseFloat(e.getAttribute("miny")),o=parseFloat(e.getAttribute("maxx")),i=parseFloat(e.getAttribute("maxy"));let d,u,p,y;t?(d=isNaN(s)?-Number.MAX_VALUE:s,u=isNaN(n)?-Number.MAX_VALUE:n,p=isNaN(i)?Number.MAX_VALUE:i,y=isNaN(o)?Number.MAX_VALUE:o):(d=isNaN(n)?-Number.MAX_VALUE:n,u=isNaN(s)?-Number.MAX_VALUE:s,p=isNaN(o)?Number.MAX_VALUE:o,y=isNaN(i)?Number.MAX_VALUE:i);const m=new $({wkid:r});return new L({xmin:d,ymin:u,xmax:p,ymax:y,spatialReference:m})}function ie(e,r){const t=x(r,e);if(t){const n=x("DCPType",t);if(n){const s=x("HTTP",n);if(s){const o=x("Get",s);if(o){let i=lt("OnlineResource","xlink:href",o,null);if(i)return i.indexOf("&")===i.length-1&&(i=i.substring(0,i.length-1)),pt(i,["service","request"])}}}}return null}function ae(e,r){const t=q("Operation",e);if(t.length===0)return q("Format",x(r,e)).map(s=>s.textContent);const n=[];return t.forEach(s=>{s.getAttribute("name")===r&&q("Format",s).forEach(o=>{n.push(o.textContent)})}),n}function le(e,r,t){const n=x(r,e);if(!n)return t;const{textContent:s}=n;if(s==null||s==="")return t;const o=Number(s);return isNaN(o)?t:o}function P(e,r,t){if(!e)return null;const n={id:t.idCounter++,fullExtents:[],parentLayerId:null,queryable:e.getAttribute("queryable")==="1",spatialReferences:[],sublayers:null},s=x("LatLonBoundingBox",e),o=x("EX_GeographicBoundingBox",e);let i=null;s&&(i=_(s,4326)),o&&(i=new L(0,0,0,0,new $({wkid:4326})),i.xmin=parseFloat(S("westBoundLongitude",o,"0")),i.ymin=parseFloat(S("southBoundLatitude",o,"0")),i.xmax=parseFloat(S("eastBoundLongitude",o,"0")),i.ymax=parseFloat(S("northBoundLatitude",o,"0"))),s||o||(i=new L(-180,-90,180,90,new $({wkid:4326}))),n.minScale=le(e,"MaxScaleDenominator",0),n.maxScale=le(e,"MinScaleDenominator",0);const d=["1.0.0","1.1.0","1.1.1"].includes(r)?"SRS":"CRS";return Array.prototype.slice.call(e.childNodes).forEach(u=>{if(u.nodeName==="Name")n.name=u.textContent||"";else if(u.nodeName==="Title")n.title=u.textContent||"";else if(u.nodeName==="Abstract")n.description=u.textContent||"";else if(u.nodeName==="BoundingBox"){const p=u.getAttribute(d);if(p&&p.indexOf("EPSG:")===0){const m=parseInt(p.substring(5),10);m===0||isNaN(m)||i||(i=r==="1.3.0"?_(u,m,X(m)):_(u,m))}const y=p&&p.indexOf(":");if(y&&y>-1){let m=parseInt(p.substring(y+1,p.length),10);m===0||isNaN(m)||(m=T[m]?T[m]:m);const b=r==="1.3.0"?_(u,m,X(m)):_(u,m);n.fullExtents.push(b)}}else if(u.nodeName===d)u.textContent.split(" ").forEach(p=>{const y=p.includes(":")?parseInt(p.split(":")[1],10):parseInt(p,10);if(y!==0&&!isNaN(y)){const m=T[y]?T[y]:y;n.spatialReferences.includes(m)||n.spatialReferences.push(m)}});else if(u.nodeName!=="Style"||n.legendURL){if(u.nodeName==="Layer"){const p=P(u,r,t);p&&(p.parentLayerId=n.id,n.sublayers||(n.sublayers=[]),n.sublayers.push(p))}}else{const p=x("LegendURL",u);if(p){const y=x("OnlineResource",p);y&&(n.legendURL=y.getAttribute("xlink:href"))}}}),n.extent=i==null?void 0:i.toJSON(),n.dimensions=q("Dimension",e).filter(u=>u.getAttribute("name")&&u.getAttribute("units")&&u.textContent).map(u=>{const p=u.getAttribute("name"),y=u.getAttribute("units"),m=u.textContent,b=u.getAttribute("unitSymbol"),w=u.getAttribute("default"),E=C("default",u,"0")!=="0",I=C("nearestValue",u,"0")!=="0",g=C("current",u,"0")!=="0";return ge({name:p,units:y})?{name:"time",units:"ISO8601",extent:pe(m),default:pe(w),multipleValues:E,nearestValue:I,current:g}:ut({name:p,units:y})?{name:"elevation",units:y,extent:oe(m),unitSymbol:b,default:oe(w),multipleValues:E,nearestValue:I}:{name:p,units:y,extent:ue(m),unitSymbol:b,default:ue(w),multipleValues:E,nearestValue:I}}),n}function ot(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}function fe(e){return e.nodeType===Node.ELEMENT_NODE}function ut(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}function ge(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function pt(e,r){const t=[],n=Le(e);for(const s in n.query)n.query.hasOwnProperty(s)&&(r.includes(s.toLowerCase())||t.push(s+"="+n.query[s]));return n.path+(t.length?"?"+t.join("&"):"")}function oe(e){if(!e)return null;const r=e.includes("/"),t=e.split(",");return r?t.map(n=>{const s=n.split("/");return s.length<2?null:{min:parseFloat(s[0]),max:parseFloat(s[1]),resolution:s.length>=3&&s[2]!=="0"?parseFloat(s[2]):void 0}}).filter(n=>n):t.map(n=>parseFloat(n))}function ue(e){if(!e)return null;const r=e.includes("/"),t=e.split(",");return r?t.map(n=>{const s=n.split("/");return s.length<2?null:{min:s[0],max:s[1],resolution:s.length>=3&&s[2]!=="0"?s[2]:void 0}}).filter(n=>n):t}function pe(e){if(!e)return null;const r=e.includes("/"),t=e.split(",");return r?t.map(n=>{const s=n.split("/");return s.length<2?null:{min:new Date(s[0]),max:new Date(s[1]),resolution:s.length>=3&&s[2]!=="0"?ct(s[2]):void 0}}).filter(n=>n):t.map(n=>new Date(n))}function ct(e){const r=/(?:p(\d+y|\d+(?:.|,)\d+y)?(\d+m|\d+(?:.|,)\d+m)?(\d+d|\d+(?:.|,)\d+d)?)?(?:t(\d+h|\d+(?:.|,)\d+h)?(\d+m|\d+(?:.|,)\d+m)?(\d+s|\d+(?:.|,)\d+s)?)?/i,t=e.match(r);return t?{years:F(t[1]),months:F(t[2]),days:F(t[3]),hours:F(t[4]),minutes:F(t[5]),seconds:F(t[6])}:null}function F(e){if(!e)return 0;const r=/(?:\d+(?:.|,)\d+|\d+)/,t=e.match(r);if(!t)return 0;const n=t[0].replace(",",".");return Number(n)}function H(e){return e.toISOString().replace(/\.[0-9]{3}/,"")}const ce=new Set([102100,3857,102113,900913]),dt=new Set([3395,54004]);function mt(e,r){let t=e.wkid;return Ae(r)?t:(!r.includes(t)&&e.latestWkid&&(t=e.latestWkid),ce.has(t)?r.find(n=>ce.has(n))||r.find(n=>dt.has(n))||102100:t)}const G=new _e({bmp:"image/bmp",gif:"image/gif",jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml"},{ignoreUnknown:!1});let c=class extends me(Pe(Ue(Me(Te(je(Ce(qe(et)))))))){constructor(...e){super(...e),this.allSublayers=new rt({getCollections:()=>[this.sublayers],getChildrenFunction:t=>t.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormat=null,this.featureInfoUrl=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType="WMS",this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type="wms",this.url=null,this.version=null;const r="wms-sublayer";this.addHandles(Ve(()=>this.sublayers,(t,n)=>{if(n){for(const s of n)s.layer=null;this.handles.remove(r)}if(t){for(const s of t)s.parent=this,s.layer=this;this.handles.add([t.on("after-add",({item:s})=>{s.parent=this,s.layer=this}),t.on("after-remove",({item:s})=>{s.parent=null,s.layer=null})],r)}},Be))}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){const r=D(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMS"]},e).catch(We).then(()=>this._fetchService(r))),Promise.resolve(this)}readFullExtentFromItemOrMap(e,r){const t=r.extent;return new L({xmin:t[0][0],ymin:t[0][1],xmax:t[1][0],ymax:t[1][1]})}writeFullExtent(e,r){r.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.includes("image/png")?"image/png":t&&t[0]}readSpatialReferenceFromItemOrDocument(e,r){return new $(r.spatialReferences[0])}writeSpatialReferences(e,r){var n;const t=(n=this.spatialReference)==null?void 0:n.wkid;e&&t?(r.spatialReferences=e.filter(s=>s!==t),r.spatialReferences.unshift(t)):r.spatialReferences=e}readSublayersFromItemOrMap(e,r,t){return de(r.layers,t,r.visibleLayers)}readSublayers(e,r,t){return de(r.layers,t)}writeSublayers(e,r,t,n){r.layers=[];const s=new Map,o=e.flatten(({sublayers:i})=>i);for(const i of o)typeof i.parent.id=="number"&&(s.has(i.parent.id)?s.get(i.parent.id).push(i.id):s.set(i.parent.id,[i.id]));for(const i of o){const d={sublayer:i,...n},u=i.write({parentLayerId:typeof i.parent.id=="number"?i.parent.id:-1},d);if(s.has(i.id)&&(u.sublayerIds=s.get(i.id)),!i.sublayers&&i.name){const p=i.write({},d);delete p.id,r.layers.push(p)}}r.visibleLayers=o.filter(({visible:i,sublayers:d})=>i&&!d).map(({name:i})=>i).toArray()}createExportImageParameters(e,r,t,n){var I;const s=(I=n==null?void 0:n.pixelRatio)!=null?I:1,o=se({extent:e,width:r})*s,i=new N({layer:this,scale:o}),{xmin:d,ymin:u,xmax:p,ymax:y,spatialReference:m}=e,b=mt(m,this.spatialReferences),w=this.version==="1.3.0"&&X(b)?`${u},${d},${y},${p}`:`${d},${u},${p},${y}`,E=i.toJSON();return{bbox:w,[this.version==="1.3.0"?"crs":"srs"]:isNaN(b)?void 0:"EPSG:"+b,...E}}async fetchImage(e,r,t,n){var y,m;const s=this.mapUrl,o=this.createExportImageParameters(e,r,t,n);if(!o.layers){const b=document.createElement("canvas");return b.width=r,b.height=t,b}const i=(y=n==null?void 0:n.timeExtent)==null?void 0:y.start,d=(m=n==null?void 0:n.timeExtent)==null?void 0:m.end,u=D(i)&&D(d)?i.getTime()===d.getTime()?H(i):`${H(i)}/${H(d)}`:void 0,p={responseType:"image",query:this._mixCustomParameters({width:r,height:t,...o,time:u,...this.refreshParameters}),signal:n==null?void 0:n.signal};return ne(s,p).then(b=>b.data)}fetchFeatureInfo(e,r,t,n,s){const o=se({extent:e,width:r}),i=new N({layer:this,scale:o}),d=at(i.visibleSublayers);if(!this.featureInfoUrl||!d)return null;const u=this.version==="1.3.0"?{I:n,J:s}:{x:n,y:s},p={query_layers:d,request:"GetFeatureInfo",info_format:this.featureInfoFormat,feature_count:25,width:r,height:t,...u},y={...this.createExportImageParameters(e,r,t),...p},m=this._mixCustomParameters(y),b=De(this.featureInfoUrl,m),w=document.createElement("iframe");w.src=b,w.style.border="none",w.style.margin="0",w.style.width="100%",w.setAttribute("sandbox","");const E=new ke({title:this.title,content:w});return new He({sourceLayer:this,popupTemplate:E})}findSublayerById(e){return this.allSublayers.find(r=>r.id===e)}findSublayerByName(e){return this.allSublayers.find(r=>r.name===e)}serviceSupportsSpatialReference(e){return Ge(this.url)||this.spatialReferences.some(r=>{const t=r===900913?$.WebMercator:new $({wkid:r});return Xe(t,e)})}async _fetchService(e){if(!this.resourceInfo){const{path:r,query:t}=this.parsedUrl;t!=null&&t.service&&(t.SERVICE=t.service,delete t.service),t!=null&&t.request&&(t.REQUEST=t.request,delete t.request);const{data:n}=await ne(r,{query:{SERVICE:"WMS",REQUEST:"GetCapabilities",...t,...this.customParameters},responseType:"xml",signal:e});this.resourceInfo=it(n)}if(this.parsedUrl){const r=new Je(this.parsedUrl.path),{httpsDomains:t}=Qe.request;r.scheme!=="https"||r.port&&r.port!=="443"||t.includes(r.host)||t.push(r.host)}this.read(this.resourceInfo,{origin:"service"})}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;const r={...this.customParameters,...this.customLayerParameters};for(const t in r)e[t.toLowerCase()]=r[t];return e}};function yt(e,r){return e.some(t=>{for(const n in t)if(tt(t,n,null,r))return!0;return!1})}function de(e,r,t){const n=new Map;e.every(o=>o.id==null)&&(e=Ye(e)).forEach((o,i)=>o.id=i);for(const o of e){const i=new J;i.read(o,r),t&&!t.includes(i.name)&&(i.visible=!1),n.set(i.id,i)}const s=[];for(const o of e){const i=n.get(o.id);if(o.parentLayerId!=null&&o.parentLayerId>=0){const d=n.get(o.parentLayerId);d.sublayers||(d.sublayers=new Y),d.sublayers.push(i)}else s.push(i)}return s}a([l({readOnly:!0})],c.prototype,"allSublayers",void 0),a([l({json:{type:Object,write:!0}})],c.prototype,"customParameters",void 0),a([l({json:{type:Object,write:!0}})],c.prototype,"customLayerParameters",void 0),a([l({type:String,json:{write:!0}})],c.prototype,"copyright",void 0),a([l()],c.prototype,"description",void 0),a([l({readOnly:!0})],c.prototype,"dimensions",void 0),a([l({json:{type:[[Number]],read:{source:"extent"},write:{target:"extent"},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],c.prototype,"fullExtent",void 0),a([R(["web-document","portal-item"],"fullExtent",["extent"])],c.prototype,"readFullExtentFromItemOrMap",null),a([k(["web-document","portal-item"],"fullExtent",{extent:{type:[[Number]]}})],c.prototype,"writeFullExtent",null),a([l()],c.prototype,"fullExtents",void 0),a([l({type:String,json:{write:{ignoreOrigin:!0}}})],c.prototype,"featureInfoFormat",void 0),a([l({type:String,json:{write:{ignoreOrigin:!0}}})],c.prototype,"featureInfoUrl",void 0),a([l({type:String,json:{origins:{"web-document":{default:"image/png",type:G.jsonValues,read:{reader:G.read,source:"format"},write:{writer:G.write,target:"format"}}}}})],c.prototype,"imageFormat",void 0),a([R("imageFormat",["supportedImageFormatTypes"])],c.prototype,"readImageFormat",null),a([l({type:Number,json:{read:{source:"maxHeight"},write:{target:"maxHeight"}}})],c.prototype,"imageMaxHeight",void 0),a([l({type:Number,json:{read:{source:"maxWidth"},write:{target:"maxWidth"}}})],c.prototype,"imageMaxWidth",void 0),a([l()],c.prototype,"imageTransparency",void 0),a([l(ze)],c.prototype,"legendEnabled",void 0),a([l({type:["show","hide","hide-children"]})],c.prototype,"listMode",void 0),a([l({type:String,json:{write:{ignoreOrigin:!0}}})],c.prototype,"mapUrl",void 0),a([l({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],c.prototype,"isReference",void 0),a([l({type:["WMS"]})],c.prototype,"operationalLayerType",void 0),a([l()],c.prototype,"resourceInfo",void 0),a([l({type:$,json:{origins:{service:{read:{source:"extent.spatialReference"}}},write:!1}})],c.prototype,"spatialReference",void 0),a([R(["web-document","portal-item"],"spatialReference",["spatialReferences"])],c.prototype,"readSpatialReferenceFromItemOrDocument",null),a([l({type:[Ke],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],c.prototype,"spatialReferences",void 0),a([k(["web-document","portal-item"],"spatialReferences")],c.prototype,"writeSpatialReferences",null),a([l({type:Y.ofType(J),json:{write:{target:"layers",overridePolicy(e,r,t){if(yt(this.allSublayers,t))return{ignoreOrigin:!0}}}}})],c.prototype,"sublayers",void 0),a([R(["web-document","portal-item"],"sublayers",["layers","visibleLayers"])],c.prototype,"readSublayersFromItemOrMap",null),a([R("service","sublayers",["layers"])],c.prototype,"readSublayers",null),a([k("sublayers",{layers:{type:[J]},visibleLayers:{type:[String]}})],c.prototype,"writeSublayers",null),a([l({json:{read:!1},readOnly:!0,value:"wms"})],c.prototype,"type",void 0),a([l(Ze)],c.prototype,"url",void 0),a([l({type:String,json:{write:{ignoreOrigin:!0}}})],c.prototype,"version",void 0),c=a([Q("esri.layers.WMSLayer")],c);const xt=c;export{xt as default};
