import{F as u,H as m,eq as wt,bm as vt,by as $t,I as te,Z as $e,er as Ze,es as Re,e3 as rt,r as p,f as $,bI as U,y as E,bc as At,an as M,N as Pe,_ as ge,ak as O,bQ as bt,et as Tt,dM as Mt,aT as Ft,ao as Rt,t as ie,s as Le,cT as Se,d3 as je,d9 as me,cR as Lt,cK as ot,cQ as de,ee as Dt,d2 as Ct,eu as st,e6 as at,bD as Et,P as It,ev as Ot,bb as _t,aM as Pt,A as De,l as St,cZ as be,C as jt,g as Nt}from"./index.96cac272.js";import{r as Ae,k as zt,x as Ut,M as Ne,j as ze,a as Ue,O as We,h as ke,L as He,b as Wt,c as le,v as Ce,g as Ee,d as kt,e as he,f as ye}from"./georeference.bd075cb5.js";import{x as Ht}from"./earcut.afc1d357.js";import{n as Bt}from"./deduplicate.cffc8550.js";import{H as N,q as it}from"./projection.241418a0.js";import{a as lt}from"./mat3.f562a113.js";import{a as Be}from"./quatf64.74f3afdd.js";import{e as ct}from"./mat4f64.ff2a477c.js";function Gt(e,n,t,r){if(!n||!t)throw new Error("Cannot construct image data without dimensions");if(Ve)try{return new ImageData(e,n,t)}catch{Ve=!1}const o=Zt(n,t,r);return o.data.set(e,0),o}function Zt(e,n,t){return t||(t=Vt()),t.getContext("2d").createImageData(e,n)}let ne=null,Ve=!0;function Vt(){return ne||(ne=document.createElement("canvas"),ne.width=1,ne.height=1),ne}var q;const Te=new WeakMap;let qt=0,I=q=class extends $e{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,n,t,r){if(e instanceof HTMLImageElement){const o={type:"image-element",src:Ze(e.src,r),crossOrigin:e.crossOrigin};n[t]=o}else if(e instanceof HTMLCanvasElement){const o=e.getContext("2d").getImageData(0,0,e.width,e.height),s={type:"canvas-element",imageData:this._encodeImageData(o)};n[t]=s}else if(e instanceof HTMLVideoElement){const o={type:"video-element",src:Ze(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};n[t]=o}else{const o={type:"image-data",imageData:this._encodeImageData(e)};n[t]=o}}readData(e){switch(e.type){case"image-element":{const n=new Image;return n.src=e.src,n.crossOrigin=e.crossOrigin,n}case"canvas-element":{const n=this._decodeImageData(e.imageData),t=document.createElement("canvas");return t.width=n.width,t.height=n.height,t.getContext("2d").putImageData(n,0,0),t}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const n=document.createElement("video");return n.src=e.src,n.crossOrigin=e.crossOrigin,n.autoplay=e.autoplay,n.loop=e.loop,n.muted=e.muted,n.preload=e.preload,n}default:return}}get transparent(){const e=this.data,n=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(n){const t=n.substr(n.length-4,4).toLowerCase(),r=n.substr(0,15).toLocaleLowerCase();if(t===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",n=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return this.url!=null?n(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?n(this.data.src):(Te.has(this.data)||Te.set(this.data,++qt),n(Te.get(this.data))):n()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new q(e)}cloneWithDeduplication(e){const n=e.get(this);if(n)return n;const t=this.clone();return e.set(this,t),t}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let n="";for(let t=0;t<e.data.length;t++)n+=String.fromCharCode(e.data[t]);return{data:btoa(n),width:e.width,height:e.height}}_decodeImageData(e){const n=atob(e.data),t=new Uint8ClampedArray(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return Gt(t,e.width,e.height)}_imageDataContainsTransparent(e){for(let n=3;n<e.data.length;n+=4)if(e.data[n]!==255)return!0;return!1}static from(e){return typeof e=="string"?new q({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new q({data:e}):Re(q,e)}};u([m({type:String,json:{write:wt}})],I.prototype,"url",null),u([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],I.prototype,"data",null),u([vt("data")],I.prototype,"writeData",null),u([$t("data")],I.prototype,"readData",null),u([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],I.prototype,"transparent",null),u([m({json:{write:!0}})],I.prototype,"wrap",void 0),u([m({readOnly:!0})],I.prototype,"contentHash",null),I=q=u([te("esri.geometry.support.MeshTexture")],I);const ae=I;var Ie;let D=Ie=class extends $e{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,n){const t=p(e)?e.get(this):null;if(t)return t;const r=new Ie(this.clonePropertiesWithDeduplication(n));return p(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:p(this.color)?this.color.clone():null,colorTexture:p(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:p(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:p(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:p(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([m({type:rt,json:{write:!0}})],D.prototype,"color",void 0),u([m({type:ae,json:{write:!0}})],D.prototype,"colorTexture",void 0),u([m({type:ae,json:{write:!0}})],D.prototype,"normalTexture",void 0),u([m({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaMode",void 0),u([m({nonNullable:!0,json:{write:!0}})],D.prototype,"alphaCutoff",void 0),u([m({nonNullable:!0,json:{write:!0}})],D.prototype,"doubleSided",void 0),u([m()],D.prototype,"colorTextureTransform",void 0),u([m()],D.prototype,"normalTextureTransform",void 0),D=Ie=u([te("esri.geometry.support.MeshMaterial")],D);const Ge=D;var Oe;let L=Oe=class extends Ge{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,n){const t=p(e)?e.get(this):null;if(t)return t;const r=new Oe(this.clonePropertiesWithDeduplication(n));return p(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:p(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:p(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:p(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:p(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:p(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:p(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:p(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([m({type:rt,json:{write:!0}})],L.prototype,"emissiveColor",void 0),u([m({type:ae,json:{write:!0}})],L.prototype,"emissiveTexture",void 0),u([m({type:ae,json:{write:!0}})],L.prototype,"occlusionTexture",void 0),u([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"metallic",void 0),u([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],L.prototype,"roughness",void 0),u([m({type:ae,json:{write:!0}})],L.prototype,"metallicRoughnessTexture",void 0),u([m()],L.prototype,"occlusionTextureTransform",void 0),u([m()],L.prototype,"emissiveTextureTransform",void 0),u([m()],L.prototype,"metallicRoughnessTextureTransform",void 0),L=Oe=u([te("esri.geometry.support.MeshMaterialMetallicRoughness")],L);const Yt=L;var fe;const ut="esri.geometry.support.MeshVertexAttributes",H=$.getLogger(ut);let T=fe=class extends $e{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return Y(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},H)}castPosition(e){return e&&e instanceof Float32Array&&H.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Y(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},H)}castUv(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},H)}castNormal(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},H)}castTangent(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},H)}clone(){const e={position:E(this.position),uv:E(this.uv),normal:E(this.normal),tangent:E(this.tangent),color:E(this.color)};return new fe(e)}clonePositional(){const e={position:E(this.position),normal:E(this.normal),tangent:E(this.tangent),uv:this.uv,color:this.color};return new fe(e)}};function Me(e,n,t,r){const{loggerTag:o,stride:s}=n;return e.length%s!=0?(r.error(o,`Invalid array length, expected a multiple of ${s}`),new t([])):e}function Y(e,n,t,r,o){if(!e)return e;if(e instanceof n)return Me(e,r,n,o);for(const s of t)if(e instanceof s)return Me(new n(e),r,n,o);if(Array.isArray(e))return Me(new n(e),r,n,o);{const s=t.map(a=>`'${a.name}'`);return o.error(`Failed to set property, expected one of ${s}, but got ${e.constructor.name}`),new n([])}}function re(e,n,t){n[t]=Jt(e)}function Jt(e){const n=new Array(e.length);for(let t=0;t<e.length;t++)n[t]=e[t];return n}u([m({json:{write:re}})],T.prototype,"color",void 0),u([U("color")],T.prototype,"castColor",null),u([m({nonNullable:!0,json:{write:re}})],T.prototype,"position",void 0),u([U("position")],T.prototype,"castPosition",null),u([m({json:{write:re}})],T.prototype,"uv",void 0),u([U("uv")],T.prototype,"castUv",null),u([m({json:{write:re}})],T.prototype,"normal",void 0),u([U("normal")],T.prototype,"castNormal",null),u([m({json:{write:re}})],T.prototype,"tangent",void 0),u([U("tangent")],T.prototype,"castTangent",null),T=fe=u([te(ut)],T);var se;const pt="esri.geometry.support.MeshComponent",Xt=$.getLogger(pt);let _=se=class extends $e{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Re(se,e)}castFaces(e){return Y(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Xt)}castMaterial(e){return Re(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?Yt:Ge,e)}clone(){return new se({faces:E(this.faces),shading:this.shading,material:E(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,n){const t={faces:E(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,n):null,trustSourceNormals:this.trustSourceNormals};return new se(t)}};u([m({json:{write:!0}})],_.prototype,"faces",void 0),u([U("faces")],_.prototype,"castFaces",null),u([m({type:Ge,json:{write:!0}})],_.prototype,"material",void 0),u([U("material")],_.prototype,"castMaterial",null),u([m({type:String,json:{write:!0}})],_.prototype,"shading",void 0),u([m({type:Boolean})],_.prototype,"trustSourceNormals",void 0),_=se=u([te(pt)],_);const K=_;function Qt(e){const n=en(e.rings,e.hasZ,xe.CCW_IS_HOLE),t=[];let r=0,o=0;for(const i of n.polygons){const c=i.count,l=i.index,g=new Float64Array(n.position.buffer,3*l*n.position.BYTES_PER_ELEMENT,3*c),d=i.holeIndices.map(f=>f-l),h=new Uint32Array(Ht(g,d,3));t.push({position:g,faces:h}),r+=g.length,o+=h.length}const s=Kt(t,r,o),a=Bt(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(a.buffer),s.faces=a.indices,s}function Kt(e,n,t){if(e.length===1)return e[0];const r=new Float64Array(n),o=new Uint32Array(t);let s=0,a=0,i=0;for(const c of e){for(let l=0;l<c.position.length;l++)r[s++]=c.position[l];for(let l=0;l<c.faces.length;l++)o[a++]=c.faces[l]+i;i=s/3}return{position:r,faces:o}}function en(e,n,t){const r=e.length,o=new Array(r),s=new Array(r),a=new Array(r);let i=0,c=0,l=0,g=0;for(let f=0;f<r;++f)g+=e[f].length;const d=new Float64Array(3*g);let h=0;for(let f=r-1;f>=0;f--){const y=e[f],R=t===xe.CCW_IS_HOLE&&tn(y);if(R&&r!==1)o[i++]=y;else{let v=y.length;for(let x=0;x<i;++x)v+=o[x].length;const A={index:h,pathLengths:new Array(i+1),count:v,holeIndices:new Array(i)};A.pathLengths[0]=y.length,y.length>0&&(a[l++]={index:h,count:y.length}),h=R?ce(y,y.length-1,-1,d,h,y.length,n):ce(y,0,1,d,h,y.length,n);for(let x=0;x<i;++x){const b=o[x];A.holeIndices[x]=h,A.pathLengths[x+1]=b.length,b.length>0&&(a[l++]={index:h,count:b.length}),h=ce(b,0,1,d,h,b.length,n)}i=0,A.count>0&&(s[c++]=A)}}for(let f=0;f<i;++f){const y=o[f];y.length>0&&(a[l++]={index:h,count:y.length}),h=ce(y,0,1,d,h,y.length,n)}return c<r&&(s.length=c),l<r&&(a.length=l),{position:d,polygons:s,outlines:a}}function ce(e,n,t,r,o,s,a){o*=3;for(let i=0;i<s;++i){const c=e[n];r[o++]=c[0],r[o++]=c[1],r[o++]=a?c[2]:0,n+=t}return o/3}function tn(e){return!At(e,!1,!1)}var xe;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(xe||(xe={}));const _e=$.getLogger("esri.geometry.support.meshUtils.centerAt");function nn(e,n,t){var o;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=(o=t==null?void 0:t.origin)!=null?o:e.origin;p(e.transform)?((t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&_e.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),rn(e.transform,n,r)):Ae(e.spatialReference,t)?on(e,n,r):sn(e,n,r)}function rn(e,n,t){const r=n.x-t.x,o=n.y-t.y,s=n.hasZ&&t.hasZ?n.z-t.z:0,a=e.origin;e.origin=[a[0]+r,a[1]+o,a[2]+s]}function on(e,n,t){const r=zt(e.vertexAttributes,t,{geographic:!0}),{position:o,normal:s,tangent:a}=Ut(r,n,{geographic:!0});e.vertexAttributes.position=o,e.vertexAttributes.normal=s,e.vertexAttributes.tangent=a,e.vertexAttributesChanged()}function sn(e,n,t){const r=cn,o=ln;if(N(n,o,e.spatialReference)){if(!N(t,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,_e.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}an(e.vertexAttributes.position,o,r),e.vertexAttributesChanged()}else _e.error(`Failed to project centerAt location (wkid:${n.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function an(e,n,t){if(e)for(let r=0;r<e.length;r+=3)for(let o=0;o<3;o++)e[r+o]+=n[o]-t[o]}const ln=M(),cn=M();async function un(e,n,t){const{loadGLTFMesh:r}=await Pe(ge(()=>import("./loadGLTFMesh.0338f597.js"),["assets/loadGLTFMesh.0338f597.js","assets/index.96cac272.js","assets/index.6fd87b6d.css","assets/mat3.f562a113.js","assets/quatf64.74f3afdd.js","assets/BufferView.e5eedfc2.js","assets/vec2.bfaa9e2d.js","assets/vec33.305d56d9.js","assets/DefaultMaterial_COLOR_GAMMA.6691fb81.js","assets/types.44c7402c.js","assets/mat4f64.ff2a477c.js","assets/enums.23a7fab5.js","assets/Version.92a1e872.js","assets/quat.b686e95d.js","assets/vectorStacks.78a180bd.js","assets/byteSizeEstimations.0938bf46.js","assets/lineSegment.299efb91.js","assets/georeference.bd075cb5.js","assets/projection.241418a0.js","assets/earcut.afc1d357.js","assets/deduplicate.cffc8550.js"]),t),o=await ht(n,t),s=r(new O({x:0,y:0,z:0,spatialReference:e.spatialReference}),o.url,{resolveFile:pn(o),useTransform:!0,signal:p(t)?t.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:a,components:i}=await s;e.vertexAttributes=a,e.components=i}function pn(e){const n=bt(e.url);return t=>{var s;const r=Tt(t,n,n),o=r?r.replace(/^ *\.\//,""):null;return(s=e.files.get(o))!=null?s:t}}async function ht(e,n){return e instanceof Blob?ee.fromBlob(e):typeof e=="string"?new ee(e):Array.isArray(e)?hn(e,n):fn(e,n)}async function hn(e,n){const t=new Map;let r=null;const o=await Mt(e.map(async a=>({name:a.name,source:await ht(a instanceof Blob?a:a.source,n)}))),s=[];for(const a of o)a&&(Ft(n)?a.source.dispose():s.push(a));Rt(n);for(const{name:a,source:i}of s)(ie(r)||/\.(gltf|glb)/i.test(a))&&(r=i.url),t.set(a,i.url),i.files&&i.files.forEach((c,l)=>t.set(l,c));if(ie(r))throw new Le("mesh-load-external:missing-files","Missing files to load external mesh source");return new ee(r,()=>s.forEach(({source:a})=>a.dispose()),t)}async function fn(e,n){const{default:t}=await Pe(ge(()=>import("./index.96cac272.js").then(o=>o.h8),["assets/index.96cac272.js","assets/index.6fd87b6d.css"]),n),r=typeof e.multipart[0]=="string"?await Promise.all(e.multipart.map(async o=>(await t(o,{responseType:"array-buffer"})).data)):e.multipart;return ee.fromBlob(new Blob(r))}class ee{constructor(n,t=()=>{},r=new Map){this.url=n,this.dispose=t,this.files=r}static fromBlob(n){const t=URL.createObjectURL(n);return new ee(t,()=>URL.revokeObjectURL(t))}}function gn(e,n,t){e.vertexAttributes&&e.vertexAttributes.position&&(p(e.transform)?((t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&$.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),mn(e.transform,n)):Ae(e.spatialReference,t)?dn(e,n):yn(e,n))}function mn(e,n){const t=e.origin;e.origin=Se(M(),t,n)}function dn(e,n){const t=e.spatialReference,r=e.vertexAttributes.position,o=e.vertexAttributes.normal,s=e.vertexAttributes.tangent,a=new Float64Array(r.length),i=p(o)?new Float32Array(o.length):null,c=p(s)?new Float32Array(s.length):null,l=e.extent.center,g=xn;it(t,[l.x,l.y,l.z],qe,je(t)),lt(Ye,qe),me(g,n,Ye),Ne(r,t,a),p(o)&&ze(o,r,a,t,i),p(s)&&Ue(s,r,a,t,c),ft(a,g),We(a,r,t),p(o)&&ke(i,r,a,t,o),p(s)&&He(c,r,a,t,s),e.vertexAttributesChanged()}function yn(e,n){ft(e.vertexAttributes.position,n),e.vertexAttributesChanged()}function ft(e,n){if(e)for(let t=0;t<e.length;t+=3)for(let r=0;r<3;r++)e[t+r]+=n[r]}const xn=M(),qe=ct(),Ye=Be();function wn(){const{faceDescriptions:e,faceVertexOffsets:n,uvScales:t}=Rn,r=4*e.length,o=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(2*e.length*3);let c=0,l=0,g=0,d=0;for(let h=0;h<e.length;h++){const f=e[h],y=c/3;for(const v of n)i[d++]=y+v;const R=f.corners;for(let v=0;v<4;v++){const A=R[v];let x=0;a[g++]=.25*t[v][0]+f.uvOrigin[0],a[g++]=f.uvOrigin[1]-.25*t[v][1];for(let b=0;b<3;b++)f.axis[b]!==0?(o[c++]=.5*f.axis[b],s[l++]=f.axis[b]):(o[c++]=.5*A[x++],s[l++]=0)}}return{position:o,normal:s,uv:a,faces:i}}function vn(e,n){const t=e.components[0],r=t.faces,o=Ln[n],s=6*o,a=new Uint32Array(6),i=new Uint32Array(r.length-6);let c=0,l=0;for(let g=0;g<r.length;g++)g>=s&&g<s+6?a[c++]=r[g]:i[l++]=r[g];if(p(e.vertexAttributes.uv)){const g=new Float32Array(e.vertexAttributes.uv),d=4*o*2,h=[0,1,1,1,1,0,0,0];for(let f=0;f<h.length;f++)g[d+f]=h[f];e.vertexAttributes.uv=g}return e.components=[new K({faces:a,material:t.material}),new K({faces:i})],e}function $n(e=0){const n=Math.round(8*2**e),t=2*n,r=(n-1)*(t+1)+2*t,o=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(3*((n-1)*t*2));let c=0,l=0,g=0,d=0;for(let h=0;h<=n;h++){const f=h/n*Math.PI+.5*Math.PI,y=Math.cos(f),R=Math.sin(f);w[2]=R;const v=h===0||h===n,A=v?t-1:t;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI;w[0]=-Math.sin(b)*y,w[1]=Math.cos(b)*y;for(let P=0;P<3;P++)o[c]=.5*w[P],s[c]=w[P],++c;a[l++]=(x+(v?.5:0))/t,a[l++]=h/n,h!==0&&x!==t&&(h!==n&&(i[g++]=d,i[g++]=d+1,i[g++]=d-t),h!==1&&(i[g++]=d,i[g++]=d-t,i[g++]=d-t-1)),d++}}return{position:o,normal:s,uv:a,faces:i}}function An(e=0){const t=Math.round(16*2**e),r=(5-1)*(t+1)+2*t,o=new Float64Array(3*r),s=new Float32Array(3*r),a=new Float32Array(2*r),i=new Uint32Array(3*(4*t));let c=0,l=0,g=0,d=0,h=0;for(let f=0;f<=5;f++){const y=f===0||f===5,R=f<=1||f>=5-1,v=f===2||f===4,A=y?t-1:t;for(let x=0;x<=A;x++){const b=x/A*2*Math.PI,P=y?0:.5;w[0]=P*Math.sin(b),w[1]=P*-Math.cos(b),w[2]=f<=2?.5:-.5;for(let k=0;k<3;k++)o[c++]=w[k],s[l++]=R?k===2?f<=1?1:-1:0:k===2?0:w[k]/P;a[g++]=(x+(y?.5:0))/t,a[g++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,v||f===0||x===t||(f!==5&&(i[d++]=h,i[d++]=h+1,i[d++]=h-t),f!==1&&(i[d++]=h,i[d++]=h-t,i[d++]=h-t-1)),h++}}return{position:o,normal:s,uv:a,faces:i}}function bn(e,n){const t=typeof n=="number"?n:n!=null?n.width:1,r=typeof n=="number"?n:n!=null?n.height:1;switch(e){case"up":case"down":return{width:t,depth:r};case"north":case"south":return{width:t,height:r};case"east":case"west":return{depth:t,height:r}}}function Tn(e){const n=oe.facingAxisOrderSwap[e],t=oe.position,r=oe.normal,o=new Float64Array(t.length),s=new Float32Array(r.length);let a=0;for(let i=0;i<4;i++){const c=a;for(let l=0;l<3;l++){const g=n[l],d=Math.abs(g)-1,h=g>=0?1:-1;o[a]=t[c+d]*h,s[a]=r[c+d]*h,a++}}return{position:o,normal:s,uv:new Float32Array(oe.uv),faces:new Uint32Array(oe.faces),isPlane:!0}}const B=1,G=2,Z=3,oe={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[Z,B,G],west:[-Z,-B,G],north:[-B,Z,G],south:[B,-Z,G],up:[B,G,Z],down:[B,-G,-Z]}};function ue(e,n,t){e.isPlane||Mn(e),Fn(e,t==null?void 0:t.size);const{vertexAttributes:r,transform:o}=Wt(e,n,t);return{vertexAttributes:new T({...r,uv:e.uv}),transform:o,components:[new K({faces:e.faces,material:t&&t.material||null})],spatialReference:n.spatialReference}}function Mn(e){for(let n=0;n<e.position.length;n+=3)e.position[n+2]+=.5}function Fn(e,n){if(n==null)return;const t=typeof n=="number"?[n,n,n]:[n.width!=null?n.width:1,n.depth!=null?n.depth:1,n.height!=null?n.height:1];S[0]=t[0],S[4]=t[1],S[8]=t[2];for(let r=0;r<e.position.length;r+=3){for(let o=0;o<3;o++)w[o]=e.position[r+o];me(w,w,S);for(let o=0;o<3;o++)e.position[r+o]=w[o]}if(t[0]!==t[1]||t[1]!==t[2]){S[0]=1/t[0],S[4]=1/t[1],S[8]=1/t[2];for(let r=0;r<e.normal.length;r+=3){for(let o=0;o<3;o++)w[o]=e.normal[r+o];me(w,w,S),Lt(w,w);for(let o=0;o<3;o++)e.normal[r+o]=w[o]}}}const Rn={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Ln={south:0,east:1,north:2,west:3,up:4,down:5},w=M(),S=Be(),gt=$.getLogger("esri.geometry.support.meshUtils.rotate");function Dn(e,n,t){var o,s;if(!e.vertexAttributes||!e.vertexAttributes.position||n[3]===0)return;const r=e.spatialReference;if(p(e.transform)){(t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&gt.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const a=(o=t==null?void 0:t.origin)!=null?o:e.transform.getOriginPoint(r);Cn(e.transform,n,a)}else{const a=(s=t==null?void 0:t.origin)!=null?s:e.origin;Ae(e.spatialReference,t)?En(e,n,a):In(e,n,a)}}function Cn(e,n,t){const r=ot(J,t.x,t.y,t.z),o=de(J,r,e.origin);e.applyLocalInverse(o,Je),e.rotation=Ce(e.rotation,n,le()),e.applyLocalInverse(o,o),de(o,o,Je),e.translation=Se(M(),e.translation,o)}function En(e,n,t){const r=e.spatialReference,o=je(r),s=mt;N(t,s,o)||N(e.origin,s,o);const a=e.vertexAttributes.position,i=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,l=new Float64Array(a.length),g=p(i)?new Float32Array(i.length):null,d=p(c)?new Float32Array(c.length):null;it(o,s,we,o),lt(Qe,we);const h=Xe;me(Ee(Xe),Ee(n),Qe),h[3]=n[3],Ne(a,r,l),p(i)&&ze(i,a,l,r,g),p(c)&&Ue(c,a,l,r,d),Q(l,h,3,s),We(l,a,r),p(i)&&(Q(g,h,3),ke(g,a,l,r,i)),p(c)&&(Q(d,h,4),He(d,a,l,r,c)),e.vertexAttributesChanged()}function In(e,n,t){const r=mt;if(!N(t,r,e.spatialReference)){const o=e.origin;r[0]=o.x,r[1]=o.y,r[2]=o.z,gt.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}Q(e.vertexAttributes.position,n,3,r),Q(e.vertexAttributes.normal,n,3),Q(e.vertexAttributes.tangent,n,4),e.vertexAttributesChanged()}function Q(e,n,t,r=st){if(!ie(e)){Dt(we,kt(n),Ee(n));for(let o=0;o<e.length;o+=t){for(let s=0;s<3;s++)J[s]=e[o+s]-r[s];Ct(J,J,we);for(let s=0;s<3;s++)e[o+s]=J[s]+r[s]}}}const J=M(),Je=M(),Xe=le(),we=ct(),Qe=Be(),mt=M(),dt=$.getLogger("esri.geometry.support.meshUtils.scale");function On(e,n,t){var o;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=e.spatialReference;if(p(e.transform)){(t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&dt.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const s=(o=t==null?void 0:t.origin)!=null?o:e.transform.getOriginPoint(r);_n(e.transform,n,s)}else{const s=Ae(e.spatialReference,t),a=t&&t.origin||e.origin;s?Pn(e,n,a):Sn(e,n,a)}}function _n(e,n,t){const r=ot(X,t.x,t.y,t.z),o=de(X,r,e.origin);e.applyLocalInverse(o,Ke);const s=at(M(),e.scale,n);e.scale=s,e.applyLocalInverse(o,o),de(o,o,Ke),e.translation=Se(M(),e.translation,o)}function Pn(e,n,t){const r=e.spatialReference,o=je(r),s=xt;N(t,s,o)||N(e.origin,s,o);const a=e.vertexAttributes.position,i=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,l=new Float64Array(a.length),g=p(i)?new Float32Array(i.length):null,d=p(c)?new Float32Array(c.length):null;Ne(a,r,l),p(i)&&ze(i,a,l,r,g),p(c)&&Ue(c,a,l,r,d),yt(l,n,s),We(l,a,r),p(i)&&ke(g,a,l,r,i),p(c)&&He(d,a,l,r,c),e.vertexAttributesChanged()}function Sn(e,n,t){const r=xt;if(!N(t,r,e.spatialReference)){const o=e.origin;r[0]=o.x,r[1]=o.y,r[2]=o.z,dt.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}yt(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}function yt(e,n,t=st){if(e)for(let r=0;r<e.length;r+=3){for(let o=0;o<3;o++)X[o]=e[r+o]-t[o];at(X,X,n);for(let o=0;o<3;o++)e[r+o]=X[o]+t[o]}}const X=M(),Ke=M(),xt=M();var C;const z="esri.geometry.Mesh";let F=C=class extends Et(It.LoadableMixin(Ot(_t))){constructor(e){super(e),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new T,this.type="mesh"}initialize(){(ie(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(Pt(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(n=>n.clone()),transform:p(this.transform)?this.transform.clone():null}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&p(this.external)&&p(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const e=this.vertexAttributes.position,n=this.spatialReference;if(e.length===0||this.components&&this.components.length===0)return{extent:new De({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:n}),center:new O({x:0,y:0,z:0,spatialReference:n})};const t=p(this.transform)?this.transform.project(e,n):e;let r=1/0,o=1/0,s=1/0,a=-1/0,i=-1/0,c=-1/0,l=0,g=0,d=0;const h=t.length,f=1/(h/3);let y=0;for(;y<h;){const R=t[y++],v=t[y++],A=t[y++];r=Math.min(r,R),o=Math.min(o,v),s=Math.min(s,A),a=Math.max(a,R),i=Math.max(i,v),c=Math.max(c,A),l+=f*R,g+=f*v,d+=f*A}return{extent:new De({xmin:r,ymin:o,zmin:s,xmax:a,ymax:i,zmax:c,spatialReference:n}),center:new O({x:l,y:g,z:d,spatialReference:n})}}get anchor(){if(p(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this._boundingInfo;return new O({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}get origin(){return p(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&p(this.external)&&p(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(e){this.loaded?(this.components||(this.components=[]),this.components.push(K.from(e)),this.notifyChange("components")):$.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(e){if(this.loaded){if(this.components){const n=this.components.indexOf(e);if(n!==-1)return this.components.splice(n,1),void this.notifyChange("components")}$.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else $.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(e,n,t,r){return he(Fe.x,e,V),he(Fe.y,n,et),he(Fe.z,t,tt),Ce(V,et,V),Ce(V,tt,V),Dn(this,V,r),this}offset(e,n,t,r){return this.loaded?(pe[0]=e,pe[1]=n,pe[2]=t,gn(this,pe,r),this):($.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(e,n){return this.loaded?(On(this,e,n),this):($.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(e,n){return this.loaded?(nn(this,e,n),this):($.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(e){return p(this.external)&&this.addResolvingPromise(un(this,this.external.source,e)),Promise.resolve(this)}clone(){let e=null;if(this.components){const t=new Map,r=new Map;e=this.components.map(o=>o.cloneWithDeduplication(t,r))}const n={components:e,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:p(this.transform)?this.transform.clone():null,external:p(this.external)?{source:this.external.source,extent:p(this.external.extent)?this.external.extent.clone():null}:null};return new C(n)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const{toBinaryGLTF:n}=await ge(()=>import("./gltfexport.026e985c.js"),["assets/gltfexport.026e985c.js","assets/index.96cac272.js","assets/index.6fd87b6d.css","assets/quat.b686e95d.js","assets/quatf64.74f3afdd.js","assets/georeference.bd075cb5.js","assets/mat4f64.ff2a477c.js","assets/mat3.f562a113.js","assets/projection.241418a0.js","assets/BufferView.e5eedfc2.js","assets/vec2.bfaa9e2d.js","assets/vec33.305d56d9.js","assets/enums.23a7fab5.js","assets/earcut.afc1d357.js","assets/deduplicate.cffc8550.js"]);return n(this,e)}static createBox(e,n){if(!(e instanceof O))return $.getLogger(z).error(".createBox()","expected location to be a Point instance"),null;const t=new C(ue(wn(),e,n));return n&&n.imageFace&&n.imageFace!=="all"?vn(t,n.imageFace):t}static createSphere(e,n){return e instanceof O?new C(ue($n(n&&n.densificationFactor||0),e,n)):($.getLogger(z).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(e,n){return e instanceof O?new C(ue(An(n&&n.densificationFactor||0),e,n)):($.getLogger(z).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(e,n){var o;if(!(e instanceof O))return $.getLogger(z).error(".createPlane()","expected location to be a Point instance"),null;const t=(o=n==null?void 0:n.facing)!=null?o:"up",r=bn(t,n==null?void 0:n.size);return new C(ue(Tn(t),e,{...n,size:r}))}static createFromPolygon(e,n){var r;if(!(e instanceof St))return $.getLogger(z).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const t=Qt(e);return new C({vertexAttributes:new T({position:t.position}),components:[new K({faces:t.faces,shading:"flat",material:(r=n==null?void 0:n.material)!=null?r:null})],spatialReference:e.spatialReference})}static async createFromGLTF(e,n,t){if(!(e instanceof O))throw $.getLogger(z).error(".createfromGLTF()","expected location to be a Point instance"),new Le("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:r}=await Pe(ge(()=>import("./loadGLTFMesh.0338f597.js"),["assets/loadGLTFMesh.0338f597.js","assets/index.96cac272.js","assets/index.6fd87b6d.css","assets/mat3.f562a113.js","assets/quatf64.74f3afdd.js","assets/BufferView.e5eedfc2.js","assets/vec2.bfaa9e2d.js","assets/vec33.305d56d9.js","assets/DefaultMaterial_COLOR_GAMMA.6691fb81.js","assets/types.44c7402c.js","assets/mat4f64.ff2a477c.js","assets/enums.23a7fab5.js","assets/Version.92a1e872.js","assets/quat.b686e95d.js","assets/vectorStacks.78a180bd.js","assets/byteSizeEstimations.0938bf46.js","assets/lineSegment.299efb91.js","assets/georeference.bd075cb5.js","assets/projection.241418a0.js","assets/earcut.afc1d357.js","assets/deduplicate.cffc8550.js"]),t);return new C(await r(e,n,t))}static createWithExternalSource(e,n,t){var a,i,c,l;const r=(a=t==null?void 0:t.extent)!=null?a:null,o=(c=(i=t==null?void 0:t.transform)==null?void 0:i.clone())!=null?c:new ye;o.origin=[e.x,e.y,(l=e.z)!=null?l:0];const s=e.spatialReference;return new C({external:{source:n,extent:r},transform:o,spatialReference:s})}static createIncomplete(e,n){var s,a,i;const t=(a=(s=n==null?void 0:n.transform)==null?void 0:s.clone())!=null?a:new ye;t.origin=[e.x,e.y,(i=e.z)!=null?i:0];const r=e.spatialReference,o=new C({transform:t,spatialReference:r});return o.addResolvingPromise(Promise.reject(new Le("mesh-incomplete","Mesh resources are not complete"))),o}};u([m({type:[K],json:{write:!0}})],F.prototype,"components",void 0),u([m({type:ye,json:{write:!0}})],F.prototype,"transform",void 0),u([m({constructOnly:!0})],F.prototype,"external",void 0),u([m({readOnly:!0})],F.prototype,"hasExtent",null),u([m({readOnly:!0})],F.prototype,"_boundingInfo",null),u([m({readOnly:!0})],F.prototype,"anchor",null),u([m({readOnly:!0})],F.prototype,"origin",null),u([m({readOnly:!0,json:{read:!1}})],F.prototype,"extent",null),u([m({readOnly:!0,json:{read:!1,write:!0,default:!0}})],F.prototype,"hasZ",void 0),u([m({readOnly:!0,json:{read:!1,write:!0,default:!1}})],F.prototype,"hasM",void 0),u([m({type:T,nonNullable:!0,json:{write:!0}})],F.prototype,"vertexAttributes",void 0),F=C=u([te(z)],F);const Fe={x:be(1,0,0),y:be(0,1,0),z:be(0,0,1)},V=le(),et=le(),tt=le(),pe=M(),nt=F;var W,ve;(function(e){e.featureGUID="featureGUID",e.assetName="assetName",e.hash="hash",e.type="type",e.conversionStatus="conversionStatus",e.flags="flags",e.complexity="complexity",e.size="size",e.seqNo="seqNo",e.sourceHash="sourceHash",e.assetURL="assetURL"})(W||(W={})),function(e){e.SUBMITTED="SUBMITTED",e.INPROGRESS="INPROGRESS",e.FAILED="FAILED",e.COMPLETED="COMPLETED"}(ve||(ve={}));function jn(e,n,t){const r=t.features;t.features=[],delete t.geometryType;const o=jt.fromJSON(t);o.geometryType="mesh";const s=o.spatialReference,a=ie(e.outFields)||!e.outFields.length?()=>({}):Nn(e.outFields.includes("*")?null:new Set(e.outFields));for(const i of r){const c=zn(i,s,n);p(c)&&o.features.push(new Nt({geometry:c,attributes:a(i)}))}return o}function Nn(e){return({attributes:n})=>{if(!n)return{};if(!e)return n;for(const t in n)e.has(t)||delete n[t];return n}}function zn(e,n,t){const{status:r,source:o}=kn(e);if(r===j.FAILED)return null;const s=Un(e,n,t),a=De.fromJSON(e.geometry);a.spatialReference=n;const i=Wn(e,t);return r===j.PENDING?nt.createIncomplete(s,{extent:a,transform:i}):nt.createWithExternalSource(s,o,{extent:a,transform:i})}function Un({attributes:e},n,{transformFieldRoles:t}){return new O({x:e[t.originX],y:e[t.originY],z:e[t.originZ],spatialReference:n})}function Wn({attributes:e,assetMappings:n},{transformFieldRoles:t}){var r;return new ye({translation:[e[t.translationX],e[t.translationY],e[t.translationZ]],rotation:he([e[t.rotationX],e[t.rotationY],e[t.rotationZ]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:!((r=n[W.flags])!=null&&r.includes("PROJECT_VERTICES"))})}function kn(e){if(!e.assetMappings)return{status:j.FAILED};const n=[],t=new Map;for(const r of e.assetMappings){const o=r[W.seqNo],s=r[W.assetName],a=r[W.assetURL],i=r[W.conversionStatus];if(i===ve.FAILED)return{status:j.FAILED};if(i!==ve.COMPLETED)return{status:j.PENDING};if(o==null)n.push({name:s,source:a});else{const c=t.get(s);let l;c?l=c.multipart:(l=[],n.push({name:s,source:{multipart:l}}),t.set(s,{multipart:l})),l[o]=a}}return{status:j.COMPLETED,source:n}}var j;(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(j||(j={}));const Xn=Object.freeze(Object.defineProperty({__proto__:null,meshFeatureSetFromJSON:jn},Symbol.toStringTag,{value:"Module"}));export{Xn as a,Yt as c,K as g,ae as m,T as p};
