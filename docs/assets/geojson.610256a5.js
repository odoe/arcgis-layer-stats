import{s as P,dA as I}from"./index.96cac272.js";import{s as N,t as A}from"./OptimizedGeometry.cf2a6bd4.js";const C={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function b(n){return C[n]}function*G(n){switch(n.type){case"Feature":yield n;break;case"FeatureCollection":for(const t of n.features)t&&(yield t)}}function*J(n){if(!n)return null;switch(n.type){case"Point":yield n.coordinates;break;case"LineString":case"MultiPoint":yield*n.coordinates;break;case"MultiLineString":case"Polygon":for(const t of n.coordinates)yield*t;break;case"MultiPolygon":for(const t of n.coordinates)for(const o of t)yield*o}}function*$(n,t={}){var r;const{geometryType:o,objectIdField:e}=t;for(const a of n){const{geometry:c,properties:i,id:l}=a;if(c&&b(c.type)!==o)continue;const s=i||{};let d=(r=s[e])!=null?r:null;e&&l!=null&&!s[e]&&(s[e]=d=l),yield new N(c?R(new A,c,t):null,s,null,d)}}function x(n){for(const t of n)if(t.length>2)return!0;return!1}function D(n){return!M(n)}function E(n){return M(n)}function M(n){let t=0;for(let o=0;o<n.length;o++){const e=n[o],r=n[(o+1)%n.length];t+=e[0]*r[1]-r[0]*e[1]}return t<=0}function k(n){const t=n[0],o=n[n.length-1];return t[0]===o[0]&&t[1]===o[1]&&t[2]===o[2]||n.push(t),n}function R(n,t,o){switch(t.type){case"LineString":return Z(n,t,o);case"MultiLineString":return B(n,t,o);case"MultiPoint":return H(n,t,o);case"MultiPolygon":return q(n,t,o);case"Point":return v(n,t,o);case"Polygon":return z(n,t,o)}}function Z(n,t,o){return h(n,t.coordinates,o),n}function B(n,t,o){for(const e of t.coordinates)h(n,e,o);return n}function H(n,t,o){return h(n,t.coordinates,o),n}function q(n,t,o){for(const e of t.coordinates){T(n,e[0],o);for(let r=1;r<e.length;r++)L(n,e[r],o)}return n}function v(n,t,o){return S(n,t.coordinates,o),n}function z(n,t,o){const e=t.coordinates;T(n,e[0],o);for(let r=1;r<e.length;r++)L(n,e[r],o);return n}function T(n,t,o){const e=k(t);D(e)?O(n,e,o):h(n,e,o)}function L(n,t,o){const e=k(t);E(e)?O(n,e,o):h(n,e,o)}function h(n,t,o){for(const e of t)S(n,e,o);n.lengths.push(t.length)}function O(n,t,o){for(let e=t.length-1;e>=0;e--)S(n,t[e],o);n.lengths.push(t.length)}function S(n,t,o){const[e,r,a]=t;n.coords.push(e,r),o.hasZ&&n.coords.push(a||0)}function K(n){switch(typeof n){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function V(n){if(!n)throw new P("geojson-layer:empty","GeoJSON data is empty");if(n.type!=="Feature"&&n.type!=="FeatureCollection")throw new P("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:n});const{crs:t}=n;if(!t)return;const o=typeof t=="string"?t:t.type==="name"?t.properties.name:t.type==="EPSG"?t.properties.code:null,e=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!e.test(o))throw new P("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function W(n,t={}){const o=[],e=new Set,r=new Set;let a,c=!1,i=null,l=!1,{geometryType:s=null}=t,d=!1;for(const g of G(n)){const{geometry:w,properties:f,id:y}=g;if((!w||(s||(s=b(w.type)),b(w.type)===s))&&(c||(c=x(J(w))),l||(l=y!=null,l&&(a=typeof y,i=Object.keys(f).filter(p=>f[p]===y))),l&&y!=null&&(i.length>1?i=i.filter(p=>f[p]===y):i.length===1&&(i=f[i[0]]===y?i:[])),!d&&f)){let p=!0;for(const u in f){if(e.has(u))continue;const F=f[u];if(F==null){p=!1,r.add(u);continue}const j=K(F);j!=="unknown"?(r.delete(u),e.add(u),o.push({name:u,alias:u,type:j})):r.add(u)}d=p}}const m=i&&i.length===1&&i[0]||null;if(m){for(const g of o)if(g.name===m&&I(g)){g.type="esriFieldTypeOID";break}}return{fields:o,geometryType:s,hasZ:c,objectIdFieldName:m,objectIdFieldType:a,unknownFields:Array.from(r)}}function X(n,t){return Array.from($(G(n),t))}export{X as L,V as O,W as T,b as i};
