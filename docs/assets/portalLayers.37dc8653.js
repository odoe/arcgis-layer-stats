import{a9 as m,s as L}from"./index.96cac272.js";import{a as d}from"./lazyLayerLoader.b3ccbd72.js";import{n as o,h as l,d as N,f as S}from"./layersLoader.a7014fcb.js";import{s as u}from"./portalItemUtils.ed60db38.js";import"./jsonContext.f4505d46.js";import"./projection.241418a0.js";function O(e){return!e.portalItem||e.portalItem instanceof m||(e={...e,portalItem:new m(e.portalItem)}),h(e.portalItem).then(r=>{const t={portalItem:e.portalItem,...r.properties};return new r.constructor(t)})}function h(e){return e.load().then(I).then(g)}function I(e){switch(e.type){case"Map Service":return w(e);case"Feature Service":return M(e);case"Feature Collection":return v(e);case"Scene Service":return T(e);case"Image Service":return P(e);case"Stream Service":return C();case"Vector Tile Service":return F();case"KML":return $();case"WFS":return j();case"WMTS":return G();case"WMS":return b();case"Feed":return K();default:return Promise.reject(new L("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type}))}}function g(e){return(0,d[e.className])().then(r=>({constructor:r,properties:e.properties}))}function w(e){return W(e).then(r=>r?{className:"TileLayer"}:{className:"MapImageLayer"})}function M(e){return p(e).then(r=>{if(typeof r=="object"){const t={};return r.id!=null&&(t.layerId=r.id),{className:"FeatureLayer",properties:t}}return{className:"GroupLayer"}})}function T(e){return p(e).then(r=>{if(typeof r=="object"){const t={};let s;if(r.id!=null?(t.layerId=r.id,s=`${e.url}/layers/${r.id}`):s=e.url,Array.isArray(e.typeKeywords)&&e.typeKeywords.length>0){const a={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",Point:"SceneLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};for(const n of Object.keys(a))if(e.typeKeywords.includes(n))return{className:a[n]}}return o(s).then(a=>{let n="SceneLayer";const c={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return a&&a.layerType&&c[a.layerType]&&(n=c[a.layerType]),{className:n,properties:t}})}return r===!1?o(e.url).then(t=>(t==null?void 0:t.layerType)==="Voxel"?{className:"VoxelLayer"}:{className:"GroupLayer"}):{className:"GroupLayer"}})}async function v(e){await e.load();const r=u(e,"Map Notes"),t=u(e,"Markup");if(r||t)return{className:"MapNotesLayer"};if(u(e,"Route Layer"))return{className:"RouteLayer"};const s=await e.fetchData();return l(s)===1?{className:"FeatureLayer"}:{className:"GroupLayer"}}async function P(e){var a,n,c,y;await e.load();const r=(n=(a=e.typeKeywords)==null?void 0:a.map(f=>f.toLowerCase()))!=null?n:[];if(r.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(r.includes("tiled imagery"))return{className:"ImageryTileLayer"};const t=(c=await e.fetchData())==null?void 0:c.layerType;return t==="ArcGISTiledImageServiceLayer"?{className:"ImageryTileLayer"}:t==="ArcGISImageServiceLayer"?{className:"ImageryLayer"}:((y=(await o(e.url)).cacheType)==null?void 0:y.toLowerCase())==="map"?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}function C(){return{className:"StreamLayer"}}function F(){return{className:"VectorTileLayer"}}function $(){return{className:"KMLLayer"}}function j(){return{className:"WFSLayer"}}function b(){return{className:"WMSLayer"}}function G(){return{className:"WMTSLayer"}}function K(){return{className:"StreamLayer"}}function W(e){return o(e.url).then(r=>r.tileInfo)}function p(e){return!e.url||e.url.match(/\/\d+$/)?Promise.resolve({}):e.load().then(()=>e.fetchData()).then(async r=>e.type==="Feature Service"?i(r=await N(r,e.url)):l(r)>0?i(r):o(e.url).then(i))}function i(e){return l(e)===1&&{id:S(e)}}export{O as fromItem,I as selectLayerClassPath};
