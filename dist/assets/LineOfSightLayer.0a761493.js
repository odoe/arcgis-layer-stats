import{bi as $,fN as j,eB as H,r,F as t,H as i,I as h,J as w,t as p,fO as g,ak as E,eF as F,fP as k,j as S,fQ as B,aM as L,bJ as R,bj as C,dV as f,ah as J,fR as M,fS as D,fT as Q,bt as V,bv as Z,bB as G}from"./index.a113d2e4.js";import{g as b}from"./persistable.252ec53f.js";import{u as K}from"./projection.eaf00ec0.js";import"./dehydratedFeatures.4c14eea0.js";import"./multiOriginJSONSupportUtils.38b69b9c.js";import"./byteSizeEstimations.0938bf46.js";import"./aaBoundingRect.afad7736.js";let U=0,a=class extends $(j(H(w))){constructor(e){super(e),this.id=`${Date.now().toString(16)}-analysis-${U++}`,this.title=null}get parent(){return this._get("parent")}set parent(e){const s=this.parent;if(r(s))switch(s.type){case"line-of-sight":s.removeAnalysis(this);break;case"2d":case"3d":s.analyses.includes(this)&&s.analyses.remove(this)}this._set("parent",e)}get isEditable(){return this.requiredPropertiesForEditing.every(r)}};t([i({type:String,constructOnly:!0,clonable:!1})],a.prototype,"id",void 0),t([i({type:String})],a.prototype,"title",void 0),t([i({constructOnly:!0})],a.prototype,"type",void 0),t([i({clonable:!1,value:null})],a.prototype,"parent",null),t([i({readOnly:!0})],a.prototype,"isEditable",null),t([i({readOnly:!0})],a.prototype,"requiredPropertiesForEditing",void 0),a=t([h("esri.analysis.Analysis")],a);const W=a;function _(e,s){return x(e)===x(s)}function x(e){if(p(e))return null;const s=e.layer!=null?e.layer.id:"";let n=null;return n=e.objectId!=null?e.objectId:e.layer!=null&&"objectIdField"in e.layer&&e.layer.objectIdField!=null&&e.attributes!=null?e.attributes[e.layer.objectIdField]:e.uid,n==null?null:`o-${s}-${n}`}const z={json:{write:{writer:X,target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:Y}}}};function X(e,s){var n;p(e)||((n=e.layer)==null?void 0:n.objectIdField)==null||e.attributes==null||(s.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function Y(e){if(e.layerId!=null&&e.objectId!=null)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}let u=class extends $(j(w)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return g(this.position,e.position)&&g(this.elevationInfo,e.elevationInfo)&&_(this.feature,e.feature)}};t([i({type:E}),b()],u.prototype,"position",void 0),t([i({type:F}),b()],u.prototype,"elevationInfo",void 0),t([i(z)],u.prototype,"feature",void 0),u=t([h("esri.analysis.LineOfSightAnalysisObserver")],u);const A=u;let y=class extends $(k){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return g(this.position,e.position)&&g(this.elevationInfo,e.elevationInfo)&&_(this.feature,e.feature)}};t([i({type:E}),b()],y.prototype,"position",void 0),t([i({type:F}),b()],y.prototype,"elevationInfo",void 0),t([i(z)],y.prototype,"feature",void 0),y=t([h("esri.analysis.LineOfSightAnalysisTarget")],y);const q=y;function ee(e,s){return p(s)||!s.mode?e?"absolute-height":"on-the-ground":s.mode}function te(e,s){return ee(!!r(e)&&e.hasZ,s)}const m=S.ofType(q);let l=class extends W{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(L(()=>this._computeExtent(),e=>{(p(e)||p(e.pending))&&this._set("extent",r(e)?e.extent:null)},R))}get targets(){return this._get("targets")||new m}set targets(e){this._set("targets",C(e,this.targets,m))}get spatialReference(){return r(this.observer)&&r(this.observer.position)?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[f(this.observer,e=>e.position)]}async waitComputeExtent(){const e=this._computeExtent();return r(e)?J(e.pending):null}_computeExtent(){const e=this.spatialReference;if(p(this.observer)||p(this.observer.position)||p(e))return null;const s=d=>te(d.position,d.elevationInfo)==="absolute-height",n=this.observer.position,I=M(n.x,n.y,n.z,n.x,n.y,n.z);for(const d of this.targets)if(r(d.position)){const c=K(d.position,e);if(r(c.pending))return{pending:c.pending,extent:null};if(r(c.geometry)){const{x:P,y:T,z:N}=c.geometry;D(I,[P,T,N])}}const v=Q(I,e);return s(this.observer)&&this.targets.every(s)||(v.zmin=null,v.zmax=null),{pending:null,extent:v}}clear(){this.observer=null,this.targets.removeAll()}};t([i({type:["line-of-sight"]})],l.prototype,"type",void 0),t([i({type:A,json:{read:!0,write:!0}})],l.prototype,"observer",void 0),t([i({cast:B,type:m,nonNullable:!0,json:{read:!0,write:!0}})],l.prototype,"targets",null),t([i({value:null,readOnly:!0})],l.prototype,"extent",void 0),t([i({readOnly:!0})],l.prototype,"spatialReference",null),t([i({readOnly:!0})],l.prototype,"requiredPropertiesForEditing",null),l=t([h("esri.analysis.LineOfSightAnalysis")],l);const O=l,se=S.ofType(q);let o=class extends V(Z(G)){constructor(e){super(e),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new O,this.opacity=1}initialize(){this.addHandles(L(()=>this.analysis,(e,s)=>{r(s)&&s.parent===this&&(s.parent=null),r(e)&&(e.parent=this)},R))}async load(){return r(this.analysis)&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return f(this.analysis,e=>e.observer)}set observer(e){f(this.analysis,s=>s.observer=e)}get targets(){return r(this.analysis)?this.analysis.targets:null}set targets(e){f(this.analysis,s=>s.targets=e)}get fullExtent(){return r(this.analysis)?this.analysis.extent:null}get spatialReference(){return r(this.analysis)?this.analysis.spatialReference:null}removeAnalysis(e){this.analysis===e&&(this.analysis=new O)}};t([i({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),t([i({type:["LineOfSightLayer"]})],o.prototype,"operationalLayerType",void 0),t([i({type:A,json:{read:!0,write:{ignoreOrigin:!0}}})],o.prototype,"observer",null),t([i({type:se,json:{read:!0,write:{ignoreOrigin:!0}}})],o.prototype,"targets",null),t([i({nonNullable:!0,json:{read:!1,write:!1}})],o.prototype,"analysis",void 0),t([i({readOnly:!0})],o.prototype,"fullExtent",null),t([i({readOnly:!0})],o.prototype,"spatialReference",null),t([i({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],o.prototype,"opacity",void 0),t([i({type:["show","hide"]})],o.prototype,"listMode",void 0),o=t([h("esri.layers.LineOfSightLayer")],o);const ue=o;export{ue as default};
